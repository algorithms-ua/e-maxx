<h1>Интегрирование по формуле Симпсона</h1>



<p>Требуется посчитать значение определённого интеграла:</p>



$$ \int_a^b f(x) dx $$



<p>Решение, описываемое здесь, было опубликовано в одной из диссертаций <b>Томаса Симпсона</b> (Thomas Simpson) в 1743 г.</p>





<h2>Формула Симпсона</h2>



<p>Пусть $n$ - некоторое натуральное число. Разобьём отрезок интегрирования $[a;b]$ на $2n$ равных частей:</p>



$$ x_i = a + i h,~~i = 0 \ldots 2n, $$

$$ h = \frac{ b-a }{ 2n }. $$



<p>Теперь посчитаем интеграл отдельно на каждом из отрезков $[x_{2i-2}, x_{2i}], i = 1 \ldots n$, а затем сложим все значения.</p>



<p>Итак, пусть мы рассматриваем очередной отрезок $[x_{2i-2}, x_{2i}], i = 1 \ldots n$. Заменим функцию $f(x)$ на нём параболой, проходящей через 3 точки $(x_{2i-2},x_{2i-1},x_{2i})$. Такая парабола всегда существует и единственна. Её можно найти аналитически, затем останется только проинтегрировать выражение для неё, и окончательно получаем:</p>



$$ \int_{x_{2i-2}}^{x_{2i}} f(x) dx = \left( f(x_{2i-2}) + 4 f(x_{2i-1}) + f(x_{2i}) \right) \frac{ h }{ 3 }. $$



<p>Складывая эти значения по всем отрезкам, получаем окончательную <b>формулу Симпсона</b>:</p>



$$ \int_a^b f(x) dx = \left( f(x_0) + 4 f(x_1) + 2 f(x_2) + 4 f(x_3) + 2 f(x_4) + \ldots + 4 f(x_{2N-1}) + f(x_{2N}) \right) \frac{ h }{ 3 }. $$





<h2>Погрешность</h2>



<p>Погрешность, даваемая формулой Симпсона, не превосходит по модулю величины:</p>



$$ \frac{ 1 }{ 180 } h^4 (b - a) \max_{a \le x \le b} \left| f^{(4)}(x) \right|. $$



<p>Таким образом, погрешность имеет порядок уменьшения как $O (n^4)$.</p>





<h2>Реализация</h2>



<p>Здесь $f(x)$ - некоторая пользовательская функция.</p>



\code

double a, b; // входные данные

const int N = 1000*1000; // количество шагов (уже умноженное на 2)

double s = 0;

double h = (b - a) / N;

for (int i=0; i<=N; ++i) {

	double x = a + h * i;

	s += f(x) * ((i==0 || i==N) ? 1 : ((i&1)==0) ? 2 : 4);

}

s *= h / 3;

\endcode